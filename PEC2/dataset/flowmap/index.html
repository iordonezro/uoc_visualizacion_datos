<!DOCTYPE html>
<html>
  <head>
    <title>Flow Map with D3.js</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
      }
      svg {
        width: 100%;
        height: 600px;
      }
      .route {
        stroke: steelblue;
        stroke-width: 1;
        opacity: 0.6;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script>
      // Set dimensions for the map
      const width = 960;
      const height = 600;

      // Create SVG container
      const svg = d3
        .select("#map")
        .append("svg")
        .attr("width", width)
        .attr("height", height);

      // Create projection and path generator
      const projection = d3
        .geoMercator()
        .scale(1000)
        .translate([width / 2, height / 2]);

      const path = d3.geoPath().projection(projection);

      // Load data
      Promise.all([
        d3.csv("airports.csv"),
        d3.csv("flights_small.csv")
      ]).then(([airports, flights]) => {
        // Map airports by IATA code
        const airportMap = new Map();
        airports.forEach((airport) => {
          airportMap.set(airport.IATA_CODE, {
            latitude: +airport.LATITUDE,
            longitude: +airport.LONGITUDE,
            name: airport.AIRPORT
          });
        });

        // Draw routes
        flights.forEach((flight) => {
          const origin = airportMap.get(flight.ORIGIN_AIRPORT);
          const destination = airportMap.get(flight.DESTINATION_AIRPORT);

          if (origin && destination) {
            svg
              .append("line")
              .attr("x1", projection([origin.longitude, origin.latitude])[0])
              .attr("y1", projection([origin.longitude, origin.latitude])[1])
              .attr("x2", projection([destination.longitude, destination.latitude])[0])
              .attr("y2", projection([destination.longitude, destination.latitude])[1])
              .attr("class", "route");
          }
        });
      });
    </script>
  </body>
</html>
